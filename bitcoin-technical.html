<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.6" />
<title>BTChip : Technical Specification</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

pre {
  padding: 0;
  margin: 0;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }


/*
 * xhtml11 specific
 *
 * */

tt {
  font-family: monospace;
  font-size: inherit;
  color: navy;
}

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

.monospaced {
  font-family: monospace;
  font-size: inherit;
  color: navy;
}

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>BTChip : Technical Specification</h1>
<span id="author">BTChip</span><br />
<span id="email"><tt>&lt;<a href="mailto:contact@btchip.com">contact@btchip.com</a>&gt;</tt></span><br />
<span id="revdate">firmware version 1.4.8 - 05.08.14-1</span>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_1_4_8_greenaddress_release_05th_of_august_2014">1. 1.4.8 ("Greenaddress" release - 05th of August 2014)</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
[enh] Allow 64 bytes seed in SETUP (BIP39 compliance)
</p>
</li>
<li>
<p>
[enh] Return the BIP32 chain code along with the public key in GET WALLET PUBLIC KEY
</p>
</li>
<li>
<p>
[enh] Add 0xB11E derivation path allowing a message signature without second factor and without power cycling, scan the low end word of derivation path components only
</p>
</li>
<li>
<p>
[bug] Remove user entropy in SETUP (not used properly and no buffer space left to type it along with a 64 bytes seed)
</p>
</li>
<li>
<p>
[bug] Allow 0 derivations in BIP32 derivation path
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_1_4_7_private_release_open_second_factor_23rd_of_july_2014">2. 1.4.7 (private release, open second factor - 23rd of July 2014)</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
[enh] Add a mode to skip the second factor if consuming from P2SH inputs
</p>
</li>
<li>
<p>
[enh] Allow derivation from an arbitrary BIP 32 path
</p>
</li>
<li>
<p>
[enh] Return Loader ID in firmware information
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_1_4_6_maison_du_bitcoin_hackathon_15th_of_june_2014">3. 1.4.6 ("Maison du Bitcoin" hackathon - 15th of June 2014)</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
[enh] Point Of Sale mode for setup and seed recovery
</p>
</li>
<li>
<p>
[enh] Allow message signature without confirmation for arbitrary BitID chain
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_1_4_5_maison_du_bitcoin_meetup_4th_of_june_2014">4. 1.4.5 ("Maison du Bitcoin" meetup - 4th of June 2014)</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
[bug] Fix keyboard LED detection on OSX (infinite waiting loop)
</p>
</li>
<li>
<p>
[bug] Fix firmware diversification
</p>
</li>
<li>
<p>
[bug] Fix generic HID transport
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_1_4_4_maison_du_bitcoin_opening_release_13th_of_may_2014">5. 1.4.4 ("Maison du Bitcoin" opening release - 13th of May 2014)</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
[bug] Fix BIP32 implementation regarding hardneded / non hardened keys
</p>
</li>
<li>
<p>
[enh] Implement missing 1.4.3 features
</p>
</li>
<li>
<p>
[enh] Type the seed using the second factor
</p>
</li>
<li>
<p>
[enh] Add firmware version in attestation
</p>
</li>
<li>
<p>
[enh] Restrict signature hashtypes on setup
</p>
</li>
<li>
<p>
[enh] Provide forward setup for prepaid dongles scenarios
</p>
</li>
<li>
<p>
[enh] Secure screen mode for Prismicide prototype
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_1_4_3_30c3_failed_release_p_20th_of_march_2014_paymium_meetup_release">6. 1.4.3 (30c3 failed release :p - 20th of March 2014 Paymium Meetup release)</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
[enh] full redesign : HD Wallet (BIP 32), Keyboard confirmation, server and partial transactions APIs
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_1_4_2_bitcoin_2013_release">7. 1.4.2 (Bitcoin 2013 release)</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
[enh] New security rules &amp; operation modes
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_1_4_1_private_release">8. 1.4.1 (private release)</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
[enh] ECC operations speed-up
</p>
</li>
<li>
<p>
[bug] Private key are now paired to their curve parameters (cheers Jix :p)
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_1_4_0_29c3_release">9. 1.4.0 (29c3 release)</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
Initial release
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_about">10. About</h2>
<div class="sectionbody">
<div class="paragraph"><p>BTChip is a USB smartcard/dongle dedicated to secure bitcoin transactions. It performs all sensitive cryptographic operations related to a bitcoin transaction (key generation &amp; signature) onboard, and helps protect against malware in an untrusted environment by controlling the signed data.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_user_validation">11. User validation</h2>
<div class="sectionbody">
<div class="paragraph"><p>BTChip allows you to validate what you sign - i.e. check that you are paying the right amount to the right destination.</p></div>
<div class="paragraph"><p>User validation is performed as follows :</p></div>
<div class="ulist"><ul>
<li>
<p>
A specific status is returned to inform the user that a validation is pending
</p>
</li>
<li>
<p>
The user unplugs the dongle
</p>
</li>
<li>
<p>
The user plugs the dongle back into the computer (or a different computer / smartphone, tablet with USB host support, depending on how confident you are about the first computer integrity)
</p>
</li>
<li>
<p>
The dongle "types" (as a keyboard) a summary of the action to be validated and a 4 digits PIN to be entered, which is unique to the transaction
</p>
</li>
<li>
<p>
The user plugs the dongle back into the first computer (or just unplugs / plugs it again)
</p>
</li>
<li>
<p>
The user enters the PIN to confirm user validation
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_operation_modes">12. Operation modes</h2>
<div class="sectionbody">
<div class="paragraph"><p>Operation modes define which operations are allowed given the security environment the dongle is operating in.</p></div>
<div class="paragraph"><p>Four operation modes are defined :</p></div>
<div class="ulist"><ul>
<li>
<p>
standard-wallet mode, managing an HD Wallet (BIP 32) with multiple accounts, supporting payments to a single address and enforcing user validation of the full transaction (unless the wallet is setup as a second factor for P2SH transactions). This mode is intended for all bitcoin users.
</p>
</li>
<li>
<p>
relaxed-wallet mode, managing an HD Wallet with multiple accounts, supporting arbitrary payments and enforcing user validation of the amount spent. This mode is intended for bitcoin users interested in drafting custom transactions with some level of control.
</p>
</li>
<li>
<p>
server mode, managing an HD Wallet with multiple accounts, supporting arbitrary payments and enforcing pre defined limits on the amount spent. This mode is intended for server operators using one or several BTChip dongles to secure their hot wallets.
</p>
</li>
<li>
<p>
developer mode, managing BIP 32 or regular private keys and allowing to sign arbitrary data. This mode is intended for bitcoin power users drafting custom transactions and only interested in private keys protection.
</p>
</li>
</ul></div>
<div class="paragraph"><p>The dongle initally operates in standard-wallet mode when received (if this mode is enabled). The last chosen mode is restored when the dongle is powered on.</p></div>
<div class="sect2">
<h3 id="_standard_wallet_mode">12.1. standard-wallet mode</h3>
<div class="paragraph"><p>Only a single point-to-point output (i.e. the standard script or a P2SH script) along with one change address is authorized.</p></div>
<div class="paragraph"><p>All transaction inputs are controlled by the dongle.</p></div>
<div class="paragraph"><p>The change address index is automatically handled by the dongle and increased for each transaction to prevent address reuse. The change address index is shared for all accounts.</p></div>
<div class="paragraph"><p>The standard script is coded as</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>OP_DUP OP_HASH160 [pubKeyHash] OP_EQUALVERIFY OP_CHECKSIG</tt></pre>
</div></div>
<div class="paragraph"><p>A P2SH script is coded as</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>OP_HASH160 [script hash] OP_EQUAL</tt></pre>
</div></div>
<div class="paragraph"><p>Transaction are controlled by the user validation process. The following data will be prompted to the user :</p></div>
<div class="ulist"><ul>
<li>
<p>
Amount to pay
</p>
</li>
<li>
<p>
Change amount
</p>
</li>
<li>
<p>
Fees
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_relaxed_wallet_mode">12.2. relaxed-wallet mode</h3>
<div class="paragraph"><p>Arbitrary output is authorized</p></div>
<div class="paragraph"><p>Transaction inputs are only controlled if they use a key actually belonging to a wallet account.</p></div>
<div class="paragraph"><p>Transaction are controlled by the user validation process. The following data will be prompted to the user :</p></div>
<div class="ulist"><ul>
<li>
<p>
Amount to pay
</p>
</li>
<li>
<p>
A large warning that relaxed-wallet mode is in use
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_server_mode">12.3. server mode</h3>
<div class="paragraph"><p>Arbitrary output is authorized</p></div>
<div class="paragraph"><p>Transaction inputs are only controlled if they use a key actually belonging to a wallet account.</p></div>
<div class="paragraph"><p>Transactions are controlled given user parameters and automatically signed if accepted.</p></div>
<div class="paragraph"><p>Transactions can be controlled on a combination of the following parameters :</p></div>
<div class="ulist"><ul>
<li>
<p>
A cumulative maximum amount used in transactions
</p>
</li>
<li>
<p>
A maximum number of consecutive transactions before the dongle is removed
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_developer_mode">12.4. developer mode</h3>
<div class="paragraph"><p>Arbitrary data can be signed in this mode</p></div>
<div class="paragraph"><p>Keys used in developer mode cannot be used in a different mode</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lifecycle_management_apdus">13. Lifecycle management APDUs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_setup_secure_screen">13.1. SETUP SECURE SCREEN</h3>
<div class="sect3">
<h4 id="_description">13.1.1. Description</h4>
<div class="paragraph"><p>This command is used to operate the dongle in a standalone terminal - instead of typing back second factor data to the user, it will be returned encrypted by the provided 3DES-2 key, which should be stored as securely as possible by the standalone terminal.</p></div>
<div class="paragraph"><p>This command is mostly intended for demonstration purposes, and is used by the Prismicide prototype.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">This function is not supported in this version</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="_coding">13.1.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">E0</p></td>
<td align="left" valign="top"><p class="table">2C</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">variable</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">3DES-2 key shared by the standalone terminal</p></td>
<td align="left" valign="top"><p class="table">16</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Output data</em></p></div>
<div class="paragraph"><p>None</p></div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is only available before the dongle is set up (either when received or following a dongle reset)</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_setup">13.2. SETUP</h3>
<div class="sect3">
<h4 id="_description_2">13.2.1. Description</h4>
<div class="paragraph"><p>This command is used to setup the dongle when received, or pre-issuance when using the forward setup mode. It must be executed on a trusted computer as security critical data is exchanged.</p></div>
<div class="paragraph"><p>For a new dongle not used as a backup device, a regular user will create a new random seed for a HD wallet and a PIN.</p></div>
<div class="paragraph"><p>The PIN is used to perform a new payment transaction - it is sent as cleartext to the dongle and is not intended to be used as a malware protection method, only as an anti theft security.
When generating a new seed in regular setup mode, the dongle types it once on the next powerup. It is recommended to do this on a different computer / device for maximum security before backing it up.</p></div>
<div class="paragraph"><p>In Point Of Sale setup mode, a PIN is exchanged between the user and the dongle. The seed is generated but not typed, and can be recovered through GET POINT OF SALE SEED commands. Until the encrypted seed is recovered, GET WALLET PUBLIC KEY is enabled without needing to enter the PIN. This mode is typically used for a service (such as a physical counter) offering prepaid dongles with KYC procedures and wanting to deliver a physical backup of the seed.</p></div>
<div class="paragraph"><p>In forward setup mode, a secret PIN is exchanged between the user and the dongle. The seed is generated but not typed, and only GET WALLET PUBLIC KEY is enabled, without needing to enter the PIN. The seed will be typed the first time the PIN is entered, after choosing a keymap. This mode is typically used for a service (such as a web shop or a vending machine) offering prepaid dongles and willing to provide the seed to the end user without compromising the security of the transactions.</p></div>
<div class="paragraph"><p>After SETUP is performed, the dongle has to be reset to wipe out all parameters and start again - this can be achieved by entering the wrong PIN 3 times in a row.</p></div>
<div class="paragraph"><p>A wipe PIN can be provided for plausible deniability - when entered instead of the regular user PIN, the seed is replaced by a random one and the device keeps operating.</p></div>
<div class="paragraph"><p>It is recommended to store the BIP32 seed returned in the output of the SETUP command in a safe location for backup purposes - typically GPG encrypt it to yourself and store it on multiple storage devices / clouds.</p></div>
</div>
<div class="sect3">
<h4 id="_coding_2">13.2.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">E0</p></td>
<td align="left" valign="top"><p class="table">20</p></td>
<td align="left" valign="top"><p class="table">00 : regular setup</p>
<p class="table">                    02 : Point Of Sale setup</p>
<p class="table">                    80 : forward setup</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data (regular setup)</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Bitflag of supported operation modes</p>
<p class="table">    0x01 : wallet mode</p>
<p class="table">    0x02 : relaxed wallet mode</p>
<p class="table">    0x04 : server mode</p>
<p class="table">    0x08 : developer mode</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Bitflag of features</p>
<p class="table">    0x01 : use uncompressed public keys in addresses (otherwise compress them)</p>
<p class="table">    0x02 : enable RFC 6979 deterministic signatures (otherwise use a random K)</p>
<p class="table">    0x04 : authorize all signature hashtypes (otherwise only authorize SIGHASH_ALL)</p>
<p class="table">    0x08 : skip second factor, allow relaxed inputs and arbitrary ouput scripts if consuming P2SH inputs in a transaction</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Key version accepted for regular addresses</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Key version accepted for Pay To Script Hash Addresses (BIP 16), or 0x00 if disabled</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">User PIN length (from 0x04 up to 0x20)</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">User PIN</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Wipe PIN length (from 0x00 up to 0x04)</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Wipe PIN</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">BIP32 Seed size (0x00 to generate a new 64 bytes seed, size between 32 and 64 to restore a seed backup)</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">BIP32 Seed if restoring a seed backup</p></td>
<td align="left" valign="top"><p class="table">variable</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">3DES-2 key wrapping key length for developer mode (0x00 to generate a new key,
  0x10 to set up a backup)</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">3DES-2 key wrapping key for developer mode</p></td>
<td align="left" valign="top"><p class="table">null or 16</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data (Point Of Sale setup)</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Bitflag of supported operation modes</p>
<p class="table">    0x01 : wallet mode</p>
<p class="table">    0x02 : relaxed wallet mode</p>
<p class="table">    0x04 : server mode</p>
<p class="table">    0x08 : developer mode</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Bitflag of features</p>
<p class="table">    0x01 : use uncompressed public keys in addresses (otherwise compress them)</p>
<p class="table">    0x02 : enable RFC 6979 deterministic signatures (otherwise use a random K)</p>
<p class="table">    0x04 : authorize all signature hashtypes (otherwise only authorize SIGHASH_ALL)</p>
<p class="table">    0x08 : skip second factor if consuming only P2SH inputs in a transaction</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Key version accepted for regular addresses</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Key version accepted for Pay To Script Hash Addresses (BIP 16), or 0x00 if disabled</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">User PIN length (from 0x04 up to 0x20)</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">User PIN</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Wipe PIN length (from 0x00 up to 0x04)</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Wipe PIN</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">BIP32 Seed size (0x00 to generate a new 64 bytes seed, 64 to restore a seed backup)</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">BIP32 Seed if restoring a seed backup</p></td>
<td align="left" valign="top"><p class="table">variable</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">0x00 or 0x10 if restoring a seed backup</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">3DES-2 seed backup wrapping key wrapping key if restoring a seed backup</p></td>
<td align="left" valign="top"><p class="table">null or 16</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data (forward setup)</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Bitflag of supported operation modes</p>
<p class="table">    0x01 : wallet mode</p>
<p class="table">    0x02 : relaxed wallet mode</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Bitflag of features</p>
<p class="table">    0x01 : use uncompressed public keys in addresses (otherwise compress them)</p>
<p class="table">    0x02 : enable RFC 6979 deterministic signatures (otherwise use a random K)</p>
<p class="table">    0x04 : authorize all signature hashtypes (otherwise only authorize SIGHASH_ALL)</p>
<p class="table">    0x08 : skip second factor if consuming only P2SH inputs in a transaction</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Key version accepted for regular addresses</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Key version accepted for Pay To Script Hash Addresses (BIP 16), or 0x00 if disabled</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">User public key length</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">User public key</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Password blob</p></td>
<td align="left" valign="top"><p class="table">40</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">BIP32 Seed flag (0x00 to generate a new seed)</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">3DES-2 key wrapping key length for developer mode (0x00 to generate a new key)</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>The password blob is generated as follows :</p></div>
<div class="ulist"><ul>
<li>
<p>
An ECDH key exchange is performed on the user side using a newly generated keypair on the Bitcoin curve and the dongle Attestation public key - a 32 bytes secret is obtained, split into two 16 bytes components S1 and S2
</p>
</li>
<li>
<p>
S1 and S2 are XORed to produce a 16 bytes 3DES-2 session key
</p>
</li>
<li>
<p>
The following data is encrypted using 3DES CBC and the generated session key, and sent as password blob
</p>
</li>
</ul></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">User PIN length (from 0x04 up to 0x20)</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">User PIN (padded with random)</p></td>
<td align="left" valign="top"><p class="table">32</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Wipe PIN length (from 0x00 up to 0x04)</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Wipe PIN (padded with random)</p></td>
<td align="left" valign="top"><p class="table">4</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">CRC-16 of the previous data</p></td>
<td align="left" valign="top"><p class="table">2</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Additional description of setup parameters</em></p></div>
<div class="paragraph"><p>When enabled, RFC 6979 deterministic signatures will be used for all operations in wallet, relaxed wallet and server modes. RFC 6979 deterministic signatures are always available in developer mode.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Using deterministic signatures will make the signing process slower and could possibly create a larger side channel attack surface due to the way private keys are handled during the computation of the random value. We suggest to only enable this mode if you don&#8217;t trust the chip hardware Random Number Generator or are sure of understanding the risks.</td>
</tr></table>
</div>
<div class="paragraph"><p>The following sample Key versions are defined for regular addresses</p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Network</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Version (dec)</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Bitcoin (main network)</p></td>
<td align="left" valign="top"><p class="table">0</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Bitcoin (test network)</p></td>
<td align="left" valign="top"><p class="table">111</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Litecoin (main network)</p></td>
<td align="left" valign="top"><p class="table">48</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Litecoin (test network)</p></td>
<td align="left" valign="top"><p class="table">111</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Dogecoin (main network)</p></td>
<td align="left" valign="top"><p class="table">30</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Dogecoin (test network)</p></td>
<td align="left" valign="top"><p class="table">113</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>The following sample Key version are defined for Pay To Script Hash addresses</p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Network</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Version (dec)</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Bitcoin (main network)</p></td>
<td align="left" valign="top"><p class="table">5</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Bitcoin (test network)</p></td>
<td align="left" valign="top"><p class="table">196</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>If generating a new seed, the dongle generates a 64 bytes random number from its hardware Random Number Generator</p></div>
<div class="paragraph"><p>A keymap encoding is a set of Keyboard HID Usage IDs mapping the keyboard layout of the computer on which the user validation is performed. It can be updated later using the SET KEYMAP command.</p></div>
<div class="paragraph" id="KeymapEncoding"><p>Keymap encoding is coded as follows</p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">ALT-GR usage keymap</p></td>
<td align="left" valign="top"><p class="table">12</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Shift usage keymap</p></td>
<td align="left" valign="top"><p class="table">12</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">HID page table for ASCII codes from 0x20 to 0x7e</p></td>
<td align="left" valign="top"><p class="table">95</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>ALT-GR &amp; Shift usage keymaps are coded as a set of flags indicating if the ALT-GR / Shift key should be pushed for the given mapping. First byte codes shift flags from keycode 0x20 (LSB) to 0x27 (MSB) and so on.</p></div>
<div class="paragraph"><p>The default QWERTY Keymap Encoding is</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>00 00 00 00 00 00 00 00 00 00 00 00
76 0f 00 d4 ff ff ff c7 00 00 00 78
2c 1e 34 20 21 22 24 34 26 27
25 2e 36 2d 37 38 27 1e 1f 20
21 22 23 24 25 26 33 33 36 2e
37 38 1f 04 05 06 07 08 09 0a
0b 0c 0d 0e 0f 10 11 12 13 14
15 16 17 18 19 1a 1b 1c 1d 2f
31 30 23 2d 35 04 05 06 07 08
09 0a 0b 0c 0d 0e 0f 10 11 12
13 14 15 16 17 18 19 1a 1b 1c
1d 2f 31 30 35</tt></pre>
</div></div>
<div class="paragraph"><p><em>Output data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Seed return flag</p>
<p class="table">      0x00 : seed is not typed to the user</p>
<p class="table">      0x01 : seed typed to the user</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">3DES-2 trusted input key</p></td>
<td align="left" valign="top"><p class="table">16</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">3DES-2 key wrapping key for developer mode</p></td>
<td align="left" valign="top"><p class="table">16</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is only available before the dongle is set up (either when received or following a dongle reset)</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_verify_pin">13.3. VERIFY PIN</h3>
<div class="sect3">
<h4 id="_description_3">13.3.1. Description</h4>
<div class="paragraph"><p>This command is used to unlock the dongle using the PIN provided during setup.</p></div>
<div class="paragraph"><p>If forward setup mode was used, the seed will be typed to the user on the first PIN entry and signature operations are enabled if a keymap was set. Otherwise the command will be denied.</p></div>
<div class="paragraph"><p>The dongle must be physically reset after each invalid PIN to issue a new command.</p></div>
<div class="paragraph"><p>After 3 invalid PIN submitted in a row, the dongle data is erased and it must be setup again.</p></div>
<div class="paragraph"><p>If the wipe PIN is entered instead of the user PIN, the device seed is replaced by a random one and the device keeps operating.</p></div>
</div>
<div class="sect3">
<h4 id="_coding_3">13.3.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">E0</p></td>
<td align="left" valign="top"><p class="table">22</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">PIN</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Output data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">PIN validation flags</p>
<p class="table">      0x01 : dongle was initialized in forward setup mode and needs to be power cycled to read the seed</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is always available following dongle setup.</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_get_operation_mode">13.4. GET OPERATION MODE</h3>
<div class="sect3">
<h4 id="_description_4">13.4.1. Description</h4>
<div class="paragraph"><p>This command returns the current operation mode used by the dongle</p></div>
<div class="paragraph"><p>The forward setup mask is present if a forward setup mode was performed and the seed has not been redeemed by the end user yet.</p></div>
</div>
<div class="sect3">
<h4 id="_coding_4">13.4.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">E0</p></td>
<td align="left" valign="top"><p class="table">24</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">01</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data</em></p></div>
<div class="paragraph"><p>None</p></div>
<div class="paragraph"><p><em>Output data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Operation Mode</p>
<p class="table">      0x01 : standard wallet
      0x02 : relaxed wallet
      0x04 : server
      0x08 : developer</p>
<p class="table">      0x80 : mask added if forward setup mode was used and the seed has not been redeemed yet</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is always available following dongle setup.</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_set_operation_mode">13.5. SET OPERATION MODE</h3>
<div class="sect3">
<h4 id="_description_5">13.5.1. Description</h4>
<div class="paragraph"><p>This command sets the operation mode that will be used by the dongle after the next power up.</p></div>
<div class="paragraph"><p>The dongle must be physically reset following this command.</p></div>
<div class="paragraph"><p>If the requested mode has been disabled on setup, an error will be returned.</p></div>
</div>
<div class="sect3">
<h4 id="_coding_5">13.5.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">E0</p></td>
<td align="left" valign="top"><p class="table">26</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">01</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Operation Mode</p>
<p class="table">      0x01 : standard wallet
      0x02 : relaxed wallet
      0x04 : server
      0x08 : developer</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Output data</em></p></div>
<div class="paragraph"><p>None</p></div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is always available following dongle setup, and is protected by the user PIN.</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_set_keymap">13.6. SET KEYMAP</h3>
<div class="sect3">
<h4 id="_description_6">13.6.1. Description</h4>
<div class="paragraph"><p>This command sets or modifies the keymap following dongle setup.</p></div>
<div class="paragraph"><p>The keymap is encoded as in <a href="#KeymapEncoding">[KeymapEncoding]</a></p></div>
</div>
<div class="sect3">
<h4 id="_coding_6">13.6.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">E0</p></td>
<td align="left" valign="top"><p class="table">28</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">77</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">ALT-GR usage keymap</p></td>
<td align="left" valign="top"><p class="table">12</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Shift usage keymap</p></td>
<td align="left" valign="top"><p class="table">12</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">HID page table for ASCII codes from 0x20 to 0x7e</p></td>
<td align="left" valign="top"><p class="table">95</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Output data</em></p></div>
<div class="paragraph"><p>None</p></div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is always available following dongle setup, and is protected by the user PIN if not operating in forward setup mode.</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_set_communication_protocol">13.7. SET COMMUNICATION PROTOCOL</h3>
<div class="sect3">
<h4 id="_description_7">13.7.1. Description</h4>
<div class="paragraph"><p>This command sets the transport protocol used by the dongle on the next power up</p></div>
<div class="paragraph"><p>The USB identifier used in WinUSB mode is 2581:1b7c</p></div>
<div class="paragraph"><p>The USB identifier used in Generic HID mode is 2581:2b7c</p></div>
</div>
<div class="sect3">
<h4 id="_coding_7">13.7.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">E0</p></td>
<td align="left" valign="top"><p class="table">2A</p></td>
<td align="left" valign="top"><p class="table">01 : use WinUSB</p>
<p class="table">                    02 : use Generic HID</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data</em></p></div>
<div class="paragraph"><p>None</p></div>
<div class="paragraph"><p><em>Output data</em></p></div>
<div class="paragraph"><p>None</p></div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is always available.</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_get_secure_screen">13.8. GET SECURE SCREEN</h3>
<div class="sect3">
<h4 id="_description_8">13.8.1. Description</h4>
<div class="paragraph"><p>This command is used to return the second factor encrypted by the secure screen 3DES-2 key if it was set up previously.</p></div>
<div class="paragraph"><p>This command is mostly intended for demonstration purposes, and is used by the Prismicide prototype.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">This function is not supported in this version</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="_coding_8">13.8.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">E0</p></td>
<td align="left" valign="top"><p class="table">2E</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">variable</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Secure screen data</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Output data</em></p></div>
<div class="paragraph"><p>None</p></div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is always available following dongle setup.</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wallet_usage_apdus">14. Wallet usage APDUs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_get_wallet_public_key">14.1. GET WALLET PUBLIC KEY</h3>
<div class="sect3">
<h4 id="_description_9">14.1.1. Description</h4>
<div class="paragraph"><p>This command returns the public key and Base58 encoded address for the given BIP 32 path.</p></div>
</div>
<div class="sect3">
<h4 id="_coding_9">14.1.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">E0</p></td>
<td align="left" valign="top"><p class="table">40</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">variable</p></td>
<td align="left" valign="top"><p class="table">variable</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Number of BIP 32 derivations to perform (max 10)</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">First derivation index (big endian)</p></td>
<td align="left" valign="top"><p class="table">4</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">&#8230;</p></td>
<td align="left" valign="top"><p class="table">4</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Last derivation index (big endian)</p></td>
<td align="left" valign="top"><p class="table">4</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Output data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Public Key length</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Uncompressed Public Key</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Base58 bitcoin address length</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Base58 encoded bitcoin address</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">BIP32 Chain code</p></td>
<td align="left" valign="top"><p class="table">32</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is always available following dongle setup in standard wallet, relaxed wallet and server operation modes, and is protected by the user PIN.</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_get_trusted_input">14.2. GET TRUSTED INPUT</h3>
<div class="sect3">
<h4 id="_description_10">14.2.1. Description</h4>
<div class="paragraph"><p>This command is used to extract a Trusted Input (encrypted transaction hash, output index, output amount) from a transaction.</p></div>
<div class="paragraph"><p>The transaction data to be provided should be encoded using bitcoin standard raw transaction encoding. Scripts can be sent over several APDUs. Other individual transaction elements split over different APDUs will be rejected. 64 bits varints are rejected.</p></div>
</div>
<div class="sect3">
<h4 id="_coding_10">14.2.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">E0</p></td>
<td align="left" valign="top"><p class="table">42</p></td>
<td align="left" valign="top"><p class="table">00 : first transaction data block</p>
<p class="table">                    80 : subsequent transaction data block</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data (first block)</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Input index to lookup (big endian)</p></td>
<td align="left" valign="top"><p class="table">4</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Transaction data</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data (next block)</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Transaction data</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Output data (non last block)</em></p></div>
<div class="paragraph"><p>None</p></div>
<div class="paragraph"><p><em>Output data (last block)</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Trusted Input</p></td>
<td align="left" valign="top"><p class="table">56</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is always available following dongle setup in standard wallet, relaxed wallet and server operation modes.</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6A80</p></td>
<td align="left" valign="top"><p class="table">Invalid data (parameters or transaction data)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6A82</p></td>
<td align="left" valign="top"><p class="table">File not found</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9804</p></td>
<td align="left" valign="top"><p class="table">Access condition not fulfilled</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_untrusted_hash_transaction_input_start">14.3. UNTRUSTED HASH TRANSACTION INPUT START</h3>
<div class="sect3">
<h4 id="_description_11">14.3.1. Description</h4>
<div class="paragraph"><p>This command is used to compose an opaque SHA-256 hash for a new transaction.</p></div>
<div class="paragraph"><p>This transaction can be verified by the user and using transaction rules according to the current dongle operation mode.</p></div>
<div class="paragraph"><p>If a new transaction is started, a VERIFY PIN command shall have been issued previously to unlock the dongle at least once following the dongle power up</p></div>
<div class="paragraph"><p>The transaction data to be provided should be encoded using bitcoin standard raw transaction encoded as follows :</p></div>
<div class="ulist"><ul>
<li>
<p>
A 1 byte flag is added before each input in the transaction - if the input is passed as a Trusted Input, this flag is set to 0x01 - otherwise, it is set to 0x00. Non Trusted Inputs can be used in relaxed mode for inputs that are not signed, or for all P2SH inputs when the dongle has been setup to skip the second factor when dealing with P2SH inputs.
</p>
</li>
<li>
<p>
When using a Trusted Input, each input outpoint is replaced by the Trusted Input length (1 byte) and the Trusted Input data
</p>
</li>
<li>
<p>
The input scripts shall be prepared by the host for the transaction signing process as per bitcoin rules : the current input script being signed shall be the previous output script (or the redeeming script when consuming a P2SH output), and other input script shall be null.
</p>
</li>
<li>
<p>
The encoded transaction data shall be provided up to (and not including) the number of outputs.
</p>
</li>
<li>
<p>
Scripts can be sent over several APDUs. Other individual transaction elements split over different APDUs will be rejected. 64 bits varints are rejected.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_coding_11">14.3.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">E0</p></td>
<td align="left" valign="top"><p class="table">44</p></td>
<td align="left" valign="top"><p class="table">00 : first transaction data block</p>
<p class="table">                    80 : subsequent transaction data block</p></td>
<td align="left" valign="top"><p class="table">00 : start signing a new transaction</p>
<p class="table">                         80 : continue signing another input of the current transaction</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Transaction data</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Output data</em></p></div>
<div class="paragraph"><p>None</p></div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is always available following dongle setup in standard wallet, relaxed wallet and server operation modes, and is protected by the user PIN when starting to sign a new transaction (P1 and P2 set to 0x00)</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6A80</p></td>
<td align="left" valign="top"><p class="table">Invalid data (parameters or transaction data)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6A82</p></td>
<td align="left" valign="top"><p class="table">File not found</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9804</p></td>
<td align="left" valign="top"><p class="table">Access condition not fulfilled</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_untrusted_hash_transaction_input_finalize">14.4. UNTRUSTED HASH TRANSACTION INPUT FINALIZE</h3>
<div class="sect3">
<h4 id="_description_12">14.4.1. Description</h4>
<div class="paragraph"><p>This command is used to compose an opaque SHA-256 hash for the transaction outputs</p></div>
<div class="paragraph"><p>This command is rejected if all inputs advertised at the beginning of the transaction have not been processed first.</p></div>
<div class="paragraph"><p>The generated script will be the standard script coded as below given the address for a non script address</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>OP_DUP OP_HASH160 [pubKeyHash] OP_EQUALVERIFY OP_CHECKSIG</tt></pre>
</div></div>
<div class="paragraph"><p>For a P2SH script address the generated script will be</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>OP_HASH160 [script hash] OP_EQUAL</tt></pre>
</div></div>
<div class="paragraph"><p>The output amount, fees and change will be validated by the user in wallet or relaxed wallet modes.</p></div>
<div class="paragraph"><p>The generated transaction output data contains in pre-serialized form the number of outputs (target &amp; optionally change) and each output data</p></div>
</div>
<div class="sect3">
<h4 id="_coding_12">14.4.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">E0</p></td>
<td align="left" valign="top"><p class="table">46</p></td>
<td align="left" valign="top"><p class="table">01 : output address provided as version byte + binary hash160</p>
<p class="table">                    02 : output address provided as base58 string</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Length of the Output Address</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Output Address (base58 or hash160)</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Amount (big endian)</p></td>
<td align="left" valign="top"><p class="table">8</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Fees (big endian)</p></td>
<td align="left" valign="top"><p class="table">8</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Number of BIP 32 derivations to perform (max 10)</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">First derivation index for the internal change address (big endian)</p></td>
<td align="left" valign="top"><p class="table">4</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">&#8230;</p></td>
<td align="left" valign="top"><p class="table">4</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Last derivation index for the internal change address (big endian)</p></td>
<td align="left" valign="top"><p class="table">4</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Output data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Generated transaction output data length</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Generated transaction output data</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Transaction user validation flag</p>
<p class="table">      0x00 : no user validation requested</p>
<p class="table">      0x01 : user validation requested</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is always available following dongle setup in standard wallet, relaxed wallet and server operation modes.</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6A80</p></td>
<td align="left" valign="top"><p class="table">Invalid data (parameters, transaction state or rules not validated)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6A82</p></td>
<td align="left" valign="top"><p class="table">File not found</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9804</p></td>
<td align="left" valign="top"><p class="table">Access condition not fulfilled</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_untrusted_hash_sign">14.5. UNTRUSTED HASH SIGN</h3>
<div class="sect3">
<h4 id="_description_13">14.5.1. Description</h4>
<div class="paragraph"><p>This command is used to sign a given secure hash using a private key (after re-hashing it following the standard Bitcoin signing process) to finalize a transaction input signing process.</p></div>
<div class="paragraph"><p>This command will be rejected if the transaction signing state is not consistent or if a user validation is required and the provided user validation code is not correct.</p></div>
</div>
<div class="sect3">
<h4 id="_coding_13">14.5.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">E0</p></td>
<td align="left" valign="top"><p class="table">48</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Number of BIP 32 derivations to perform (max 10)</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">First derivation index for the private key to use(big endian)</p></td>
<td align="left" valign="top"><p class="table">4</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">&#8230;</p></td>
<td align="left" valign="top"><p class="table">4</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Last derivation index for the private key to use (big endian)</p></td>
<td align="left" valign="top"><p class="table">4</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">User validation code length (or 0x00)</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">User validation code</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Lock Time (big endian)</p></td>
<td align="left" valign="top"><p class="table">4</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">SigHashType</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Output data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Signed hash, as ASN-1 encoded R &amp; S components</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">SigHashType</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is always available following dongle setup in standard wallet, relaxed wallet and server operation modes.</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6A82</p></td>
<td align="left" valign="top"><p class="table">File not found</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9804</p></td>
<td align="left" valign="top"><p class="table">Access condition not fulfilled</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_untrusted_hash_transaction_input_finalize_full">14.6. UNTRUSTED HASH TRANSACTION INPUT FINALIZE FULL</h3>
<div class="sect3">
<h4 id="_description_14">14.6.1. Description</h4>
<div class="paragraph"><p>This command is used to compose an opaque SHA-256 hash for the transaction outputs</p></div>
<div class="paragraph"><p>This command is rejected if all inputs advertised at the beginning of the transaction have not been processed first.</p></div>
<div class="paragraph"><p>Output data can be split arbitrarily.</p></div>
</div>
<div class="sect3">
<h4 id="_coding_14">14.6.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">E0</p></td>
<td align="left" valign="top"><p class="table">4A</p></td>
<td align="left" valign="top"><p class="table">00 : more input data to be sent</p>
<p class="table">                    80 : last input data block to be sent</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data (first block)</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Start of output data, containing the number of outputs encoded as a Bitcoin varint</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data (optional next blocks)</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Output data continued</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Output data (not last block)</em></p></div>
<div class="paragraph"><p>None</p></div>
<div class="paragraph"><p><em>Output data (last block)</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Transaction user validation flag</p>
<p class="table">      0x00 : no user validation requested</p>
<p class="table">      0x01 : user validation requested</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is available following dongle setup in standard wallet mode when the dongle has been setup to skip the second factor when dealing with P2SH inputs and the current transaction is consuming P2SH inputs, or always available following dongle setup in relaxed wallet and server operation modes.</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6A80</p></td>
<td align="left" valign="top"><p class="table">Invalid data (parameters, transaction state or rules not validated)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6A82</p></td>
<td align="left" valign="top"><p class="table">File not found</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9804</p></td>
<td align="left" valign="top"><p class="table">Access condition not fulfilled</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sign_message">14.7. SIGN MESSAGE</h3>
<div class="sect3">
<h4 id="_description_15">14.7.1. Description</h4>
<div class="paragraph"><p>This command is used to sign a maximum 140 bytes long text message using a private key. The message must be ASCII printable (each byte of the message must be between 0x20 and 0x7e, both included)</p></div>
<div class="paragraph"><p>The message is provided to the dongle, which types it along with a single usage transaction PIN when it&#8217;s power cycled.</p></div>
<div class="paragraph"><p>The transaction PIN is then sent back to this command to retrieve the message signature</p></div>
<div class="paragraph"><p>The signature is performed as follows :</p></div>
<div class="ulist"><ul>
<li>
<p>
The data to sign is the magic "\x18Bitcoin Signed Message:\n" - followed by the length of the message to sign on 1 byte (if requested) followed by the binary content of the message
</p>
</li>
<li>
<p>
The signature is performed on a double SHA-256 hash of the data to sign using the selected private key
</p>
</li>
</ul></div>
<div class="paragraph"><p>The signature is returned using the standard ASN-1 encoding. To convert it to the proprietary Bitcoin-QT format, the host has to :</p></div>
<div class="ulist"><ul>
<li>
<p>
Perform key recovery on the signature as defined in SEC 1 paragraph 4.1.6
</p>
</li>
<li>
<p>
Add 27 to j if the public key is not compressed, otherwise add 31 to j
</p>
</li>
<li>
<p>
Return the Base64 encoded version of j || r || s
</p>
</li>
</ul></div>
<div class="paragraph"><p>If the low end word of one component of the BIP 32 derivation path includes 0xB11D or 0xB11E the message is immediately signed without confirmation (typically used for BitID). The dongle must be powercycled after signing with a derivation path containing 0xB11D.</p></div>
</div>
<div class="sect3">
<h4 id="_coding_15">14.7.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">E0</p></td>
<td align="left" valign="top"><p class="table">4E</p></td>
<td align="left" valign="top"><p class="table">00 : prepare message</p>
<p class="table">                    80 : sign message</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data in prepare mode</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Number of BIP 32 derivations to perform (max 10)</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">First derivation index of the private key to use (big endian)</p></td>
<td align="left" valign="top"><p class="table">4</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">&#8230;</p></td>
<td align="left" valign="top"><p class="table">4</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Last derivation index of the private key to use (big endian)</p></td>
<td align="left" valign="top"><p class="table">4</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Message length (max 140)</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Message</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data in sign mode</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">User validation code length (or 00 in server mode)</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">User validation code</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Output data in prepare mode</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Transaction user validation flag</p>
<p class="table">      0x00 : no user validation requested</p>
<p class="table">      0x01 : user validation requested</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Output data in sign mode</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">ASN-1 encoded message signature</p></td>
<td align="left" valign="top"><p class="table">variable</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is always available following dongle setup in standard wallet, relaxed wallet and server operation modes and is protected by the user PIN when preparing a message to sign (P1 set to 0x00)</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6A80</p></td>
<td align="left" valign="top"><p class="table">Invalid data (parameters, ASCII message not validated)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6A82</p></td>
<td align="left" valign="top"><p class="table">File not found</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9804</p></td>
<td align="left" valign="top"><p class="table">Access condition not fulfilled</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_server_mode_apdus">15. Server mode APDUs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_get_transaction_limit">15.1. GET TRANSACTION LIMIT</h3>
<div class="sect3">
<h4 id="_description_16">15.1.1. Description</h4>
<div class="paragraph"><p>This command returns the current cumulative amount limit and the number of transactions remaining</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">This function is not supported in this version</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="_coding_16">15.1.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">E0</p></td>
<td align="left" valign="top"><p class="table">A0</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">0C</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data</em></p></div>
<div class="paragraph"><p>None</p></div>
<div class="paragraph"><p><em>Output data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Remaining cumulative amount (big endian)</p></td>
<td align="left" valign="top"><p class="table">8</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Remaining number of transactions</p></td>
<td align="left" valign="top"><p class="table">4</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is always available following dongle setup in server operation modes.</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_set_transaction_limit">15.2. SET TRANSACTION LIMIT</h3>
<div class="sect3">
<h4 id="_description_17">15.2.1. Description</h4>
<div class="paragraph"><p>This command sets the current cumulative amount limit and the number of transactions remaining.</p></div>
<div class="paragraph"><p>This command is protected by the HOTP server key. If the OTP is correct, the command is executed, the transaction limit is updated immediately and the OTP sequence counter is increased.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">This function is not supported in this version</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="_coding_17">15.2.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">E0</p></td>
<td align="left" valign="top"><p class="table">A2</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">10</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">8 digits HOTP code</p></td>
<td align="left" valign="top"><p class="table">8</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Cumulative amount (big endian)</p></td>
<td align="left" valign="top"><p class="table">8</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Number of transactions after power up</p></td>
<td align="left" valign="top"><p class="table">4</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Output data</em></p></div>
<div class="paragraph"><p>None</p></div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is always available following dongle setup in server operation modes.</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_developer_mode_apdus">16. Developer mode APDUs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_import_private_key">16.1. IMPORT PRIVATE KEY</h3>
<div class="sect3">
<h4 id="_description_18">16.1.1. Description</h4>
<div class="paragraph"><p>This command imports a regular private key, a BIP32 private key or a BIP32 seed and returns an encrypted version of the private key that this dongle can use for future operations.</p></div>
</div>
<div class="sect3">
<h4 id="_coding_18">16.1.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">E0</p></td>
<td align="left" valign="top"><p class="table">B0</p></td>
<td align="left" valign="top"><p class="table">Import method</p>
<p class="table">                    0x01 : Base58 encoded private key or BIP32 private key</p>
<p class="table">                    0x02 : BIP32 seed</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Base58 private key or seed</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Output data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Encoded private key</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is always available following dongle setup in developer operation mode.</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_get_public_key">16.2. GET PUBLIC KEY</h3>
<div class="sect3">
<h4 id="_description_19">16.2.1. Description</h4>
<div class="paragraph"><p>This command returns the public key or the extended public key for an encoded private key</p></div>
</div>
<div class="sect3">
<h4 id="_coding_19">16.2.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">E0</p></td>
<td align="left" valign="top"><p class="table">B2</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Encoded private key length</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Encoded private key</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Output data (non HD key)</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Flag : 0x01</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Public key length</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Public key</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Output data (HD key)</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Flag : 0x02</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Public key length</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Public key</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Chain code</p></td>
<td align="left" valign="top"><p class="table">32</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Depth</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Parent fingerprint</p></td>
<td align="left" valign="top"><p class="table">4</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Child number (big endian)</p></td>
<td align="left" valign="top"><p class="table">4</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is always available following dongle setup in developer operation mode, and is protected by the user PIN. It is always available in "masked seed" mode without presenting a PIN.</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_derive_bip32_key">16.3. DERIVE BIP32 KEY</h3>
<div class="sect3">
<h4 id="_description_20">16.3.1. Description</h4>
<div class="paragraph"><p>This command derives a BIP32 key to return a child key.</p></div>
<div class="paragraph"><p>This command returns an error if operating on a non BIP32 key</p></div>
<div class="paragraph"><p>Both hardened and non hardened derivation modes are supported.</p></div>
</div>
<div class="sect3">
<h4 id="_coding_20">16.3.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">E0</p></td>
<td align="left" valign="top"><p class="table">B4</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Encoded private key length</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Encoded private key</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Child index (big endian)</p></td>
<td align="left" valign="top"><p class="table">4</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Output data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Encoded private key</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is always available following dongle setup in developer operation mode, or in "masked seed" mode.</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6A80</p></td>
<td align="left" valign="top"><p class="table">Invalid data</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ecdsa_sign_verify_immediate">16.4. ECDSA SIGN/VERIFY IMMEDIATE</h3>
<div class="sect3">
<h4 id="_description_21">16.4.1. Description</h4>
<div class="paragraph"><p>This command is used to sign a given hash using an encoded private key or verify a given signature using a public key</p></div>
</div>
<div class="sect3">
<h4 id="_coding_21">16.4.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">E0</p></td>
<td align="left" valign="top"><p class="table">B6</p></td>
<td align="left" valign="top"><p class="table">00 : sign</p>
<p class="table">                     80 : verify</p></td>
<td align="left" valign="top"><p class="table">00 : sign with random K</p>
<p class="table">                                            80 : sign with deterministic K</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data (sign mode)</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Length of encoded private key</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Encoded private key</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Length of hash to sign (up to 32 bytes)</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Hash to sign</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data (verify mode)</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Length of uncompressed public key</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Uncompressed Public key</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Length of hash to verify (up to 32 bytes)</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Hash to verify  </p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Signature</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Output data (sign mode)</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Signed hash, as ASN-1 encoded R &amp; S components</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Output data (verify mode)</em></p></div>
<div class="paragraph"><p>None</p></div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is always available following dongle setup in developer operation mode, and is protected by the user PIN</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6A80</p></td>
<td align="left" valign="top"><p class="table">Invalid data (invalid key encryption, invalid signature)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6A82</p></td>
<td align="left" valign="top"><p class="table">File not found</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9804</p></td>
<td align="left" valign="top"><p class="table">Access condition not fulfilled</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_test_and_utility_apdus">17. Test and utility APDUs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_get_random">17.1. GET RANDOM</h3>
<div class="sect3">
<h4 id="_description_22">17.1.1. Description</h4>
<div class="paragraph"><p>This command returns random bytes from the dongle hardware random number generator</p></div>
</div>
<div class="sect3">
<h4 id="_coding_22">17.1.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">E0</p></td>
<td align="left" valign="top"><p class="table">C0</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">variable</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data</em></p></div>
<div class="paragraph"><p>None</p></div>
<div class="paragraph"><p><em>Output data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Random bytes</p></td>
<td align="left" valign="top"><p class="table">variable</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is always available.</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_get_device_attestation">17.2. GET DEVICE ATTESTATION</h3>
<div class="sect3">
<h4 id="_description_23">17.2.1. Description</h4>
<div class="paragraph"><p>This command returns a signature of the 6 bytes current firmware version concatenated to the given blob by the attestation key.</p></div>
</div>
<div class="sect3">
<h4 id="_coding_23">17.2.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">E0</p></td>
<td align="left" valign="top"><p class="table">C2</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">08</p></td>
<td align="left" valign="top"><p class="table">variable</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Blob to sign</p></td>
<td align="left" valign="top"><p class="table">8</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Output data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Attestation key batch ID</p></td>
<td align="left" valign="top"><p class="table">04</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Attestation key derivation index ID</p></td>
<td align="left" valign="top"><p class="table">04</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Firmware major version</p></td>
<td align="left" valign="top"><p class="table">02</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Firmware minor version</p></td>
<td align="left" valign="top"><p class="table">01</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Firmware patch version</p></td>
<td align="left" valign="top"><p class="table">01</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Loader ID major version</p></td>
<td align="left" valign="top"><p class="table">01</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Loader ID minor version</p></td>
<td align="left" valign="top"><p class="table">01</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Signature of 6 previous bytes + blob</p></td>
<td align="left" valign="top"><p class="table">variable</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is always available.</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_get_firmware_version">17.3. GET FIRMWARE VERSION</h3>
<div class="sect3">
<h4 id="_description_24">17.3.1. Description</h4>
<div class="paragraph"><p>This command returns the firmware version of the dongle</p></div>
</div>
<div class="sect3">
<h4 id="_coding_24">17.3.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">E0</p></td>
<td align="left" valign="top"><p class="table">C4</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">07</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data</em></p></div>
<div class="paragraph"><p>None</p></div>
<div class="paragraph"><p><em>Output data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Internal public keys compression flag</p>
<p class="table">                    0x00 : keys are not compressed</p>
<p class="table">                    0x01 : keys are compressed</p></td>
<td align="left" valign="top"><p class="table">01</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Firmware major version</p></td>
<td align="left" valign="top"><p class="table">02</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Firmware minor version</p></td>
<td align="left" valign="top"><p class="table">01</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Firmware patch version</p></td>
<td align="left" valign="top"><p class="table">01</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Loader ID major version</p></td>
<td align="left" valign="top"><p class="table">01</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Loader ID minor version</p></td>
<td align="left" valign="top"><p class="table">01</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is always available.</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compose_m_of_n_address">17.4. COMPOSE M OF N ADDRESS</h3>
<div class="sect3">
<h4 id="_description_25">17.4.1. Description</h4>
<div class="paragraph"><p>This command is used to create and check on the fly a P2SH payment address to an M of N transaction, according to BIP 16 and BIP 11.</p></div>
<div class="paragraph"><p>Each public key address is prompted to the user and validated by entering a PIN code as per the second factor mechanism.</p></div>
<div class="paragraph"><p>After all public key addresses have been provided, the final address is typed to the user using the second factor mechanism.</p></div>
<div class="paragraph"><p>Public keys can be provided in compressed or uncompressed format.</p></div>
</div>
<div class="sect3">
<h4 id="_coding_25">17.4.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">E0</p></td>
<td align="left" valign="top"><p class="table">C6</p></td>
<td align="left" valign="top"><p class="table">00 : start composing a new address</p>
<p class="table">                    80 : continue composing an address with a new public key</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">variable</p></td>
<td align="left" valign="top"><p class="table">variable</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data (for a new address)</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">M (number of signatures to provide to redeem the transaction, must be smaller than or equal to N)</p></td>
<td align="left" valign="top"><p class="table">01</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">N (total number of public keys provided, must be smaller than or equal to 3)</p></td>
<td align="left" valign="top"><p class="table">01</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Public key</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data (to keep on submitting a new key)</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Authorization length</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Authorization</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Optional Public key, ignored for the last one</p></td>
<td align="left" valign="top"><p class="table">var</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Output data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">User validation flag</p>
<p class="table">      0x01 : user validation requested</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is always available following dongle setup (but is not usable in server mode)</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_get_point_of_sale_seed">17.5. GET POINT OF SALE SEED</h3>
<div class="sect3">
<h4 id="_description_26">17.5.1. Description</h4>
<div class="paragraph"><p>This command is used to retrieve the seed backup if the dongle was set up in Point Of Sale mode.</p></div>
<div class="paragraph"><p>The seed backup is split into 2 components :</p></div>
<div class="ulist"><ul>
<li>
<p>
A seed 3DES encryption key, randomly generated by the dongle
</p>
</li>
<li>
<p>
The encrypted seed
</p>
</li>
</ul></div>
<div class="paragraph"><p>It is recommended to retrieve each seed component on a different host.</p></div>
<div class="paragraph"><p>The dongle must be powercycled after processing this command.</p></div>
</div>
<div class="sect3">
<h4 id="_coding_26">17.5.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">E0</p></td>
<td align="left" valign="top"><p class="table">CA</p></td>
<td align="left" valign="top"><p class="table">01 : request seed encryption key</p>
<p class="table">                    02 : request encrypted seed</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">variable</p></td>
<td align="left" valign="top"><p class="table">variable</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data</em></p></div>
<div class="paragraph"><p>None</p></div>
<div class="paragraph"><p><em>Output data (for seed encryption key)</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Seed encryption key</p></td>
<td align="left" valign="top"><p class="table">16</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Output data (for encrypted seed)</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Encrypted seed</p></td>
<td align="left" valign="top"><p class="table">64</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is available after setup in Point Of Sale mode and is disabled after the encrypted seed is retrieved once</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_vendor_management_apdus">18. Vendor management APDUs</h2>
<div class="sectionbody">
<div class="paragraph"><p>These APDUs are used for factory setup and firmware updates.</p></div>
<div class="sect2">
<h3 id="_factory_initialize_keys">18.1. FACTORY INITIALIZE KEYS</h3>
<div class="sect3">
<h4 id="_description_27">18.1.1. Description</h4>
<div class="paragraph"><p>This command is used to derive the factory update and attestation storage keys from the shared rom key before issuance.</p></div>
</div>
<div class="sect3">
<h4 id="_coding_27">18.1.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">D0</p></td>
<td align="left" valign="top"><p class="table">20</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">28</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Firmware update ID</p></td>
<td align="left" valign="top"><p class="table">08</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Attestation storage key diversifier</p></td>
<td align="left" valign="top"><p class="table">10</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Firmware update key diversifier</p></td>
<td align="left" valign="top"><p class="table">10</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Output data</em></p></div>
<div class="paragraph"><p>None</p></div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is only available pre issuance</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_factory_initialize_attestation">18.2. FACTORY INITIALIZE ATTESTATION</h3>
<div class="sect3">
<h4 id="_description_28">18.2.1. Description</h4>
<div class="paragraph"><p>This command sets up the attestation private key used to authenticate the device.</p></div>
<div class="paragraph"><p>The dongle switches to post-issuance mode once this APDU is received and handled successfully.</p></div>
</div>
<div class="sect3">
<h4 id="_coding_28">18.2.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">D0</p></td>
<td align="left" valign="top"><p class="table">22</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">2B</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Attestation key batch ID</p></td>
<td align="left" valign="top"><p class="table">04</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Attestation key derivation index ID</p></td>
<td align="left" valign="top"><p class="table">04</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Wrapped attestation private key</p></td>
<td align="left" valign="top"><p class="table">35</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Output data</em></p></div>
<div class="paragraph"><p>None</p></div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is only available pre issuance</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_get_firmware_update_id">18.3. GET FIRMWARE UPDATE ID</h3>
<div class="sect3">
<h4 id="_description_29">18.3.1. Description</h4>
<div class="paragraph"><p>This command returns the firmware update ID of this dongle.</p></div>
</div>
<div class="sect3">
<h4 id="_coding_29">18.3.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">D0</p></td>
<td align="left" valign="top"><p class="table">24</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">08</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data</em></p></div>
<div class="paragraph"><p>None</p></div>
<div class="paragraph"><p><em>Output data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Firmware update ID</p></td>
<td align="left" valign="top"><p class="table">08</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is only available before the dongle is set up (either when received or following a dongle reset)</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_firmware_update">18.4. FIRMWARE UPDATE</h3>
<div class="sect3">
<h4 id="_description_30">18.4.1. Description</h4>
<div class="paragraph"><p>This command is used to update the dongle firmware.</p></div>
<div class="paragraph"><p>The dongle must not been set up to issue this command - if the dongle is set up, first wipe the user data by issuing the wrong user PIN 3 times.</p></div>
</div>
<div class="sect3">
<h4 id="_coding_30">18.4.2. Coding</h4>
<div class="paragraph"><p><em>Command</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<col width="16%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>CLA</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>INS</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P1</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>P2</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Lc</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Le</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">D0</p></td>
<td align="left" valign="top"><p class="table">42</p></td>
<td align="left" valign="top"><p class="table">03 : start bootloader</p>
<p class="table">                     06 : load bootloader</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
<td align="left" valign="top"><p class="table">variable</p></td>
<td align="left" valign="top"><p class="table">00</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Input data</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Firmware blob</p></td>
<td align="left" valign="top"><p class="table">variable</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p><em>Output data</em></p></div>
<div class="paragraph"><p>None</p></div>
<div class="paragraph"><p><em>Availability</em></p></div>
<div class="paragraph"><p>This function is only available before the dongle is set up (either when received or following a dongle reset)</p></div>
<div class="paragraph"><p><em>Status Words</em></p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>SW</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6581</p></td>
<td align="left" valign="top"><p class="table">Memory problem</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6700</p></td>
<td align="left" valign="top"><p class="table">Incorrect length</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6982</p></td>
<td align="left" valign="top"><p class="table">Security status not satisfied (Bitcoin dongle is locked or invalid access rights)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6B00</p></td>
<td align="left" valign="top"><p class="table">Incorrect parameter P1 or P2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">6Fxx</p></td>
<td align="left" valign="top"><p class="table">Technical problem (00 : no diagnostic given)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">9000</p></td>
<td align="left" valign="top"><p class="table">Normal ending of the command</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_data_structures">19. Data structures</h2>
<div class="sectionbody">
<div class="paragraph"><p>The format of the data structures is provided for interoperability and validation purposes. A typical user will not need to manipulate them directly.</p></div>
<div class="sect2">
<h3 id="_encoded_private_key_in_developer_mode">19.1. Encoded private key in developer mode</h3>
<div class="paragraph"><p>An encoded private key is stored internally as follow. The private key component (S) and optional chain are triple DES encrypted by the developer mode wrapping key in CBC mode with a null IV (as S alone or S concatenated to the chain code)</p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Magic version (<strong>01</strong>)</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Private key type</p>
<p class="table">    0x01 : standard private key</p>
<p class="table">    0x02 : BIP32 private key</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Version</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Private key component (S)</p></td>
<td align="left" valign="top"><p class="table">32</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">If BIP32, chain code</p></td>
<td align="left" valign="top"><p class="table">32</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">If BIP32, depth</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">If BIP32, parent fingerprint</p></td>
<td align="left" valign="top"><p class="table">4</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">If BIP32, child number (big endian)</p></td>
<td align="left" valign="top"><p class="table">4</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_encoded_trusted_input">19.2. Encoded trusted input</h3>
<div class="paragraph"><p>An encoded trusted input is stored internally as follow. The signature is the last block of a Triple DES CBC encryption of the previous data by the trusted input encryption key.</p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Magic version (<strong>32</strong>)</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Flags</p>
<p class="table">    RFU</p></td>
<td align="left" valign="top"><p class="table">1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Nonce</p></td>
<td align="left" valign="top"><p class="table">2</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Associated transaction hash</p></td>
<td align="left" valign="top"><p class="table">32</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Index in associated transaction</p></td>
<td align="left" valign="top"><p class="table">4</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Associated amount</p></td>
<td align="left" valign="top"><p class="table">8</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Signature</p></td>
<td align="left" valign="top"><p class="table">8</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_specific_data_transport_for_firmware_update_or_private_key_attestation_storage">19.3. Specific data transport for firmware update or private key attestation storage</h3>
<div class="paragraph"><p>Data sent for firmware update or private key attestation storage is formatted as follows, encrypted by either the diversified firmware update key or the diversified attestation storage key</p></div>
<div class="tableblock">
<table rules="all"
width="80%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><strong>Description</strong></p></td>
<td align="left" valign="top"><p class="table"><strong>Length</strong></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Data size without padding</p></td>
<td align="left" valign="top"><p class="table">01</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">3DES-CBC encrypted data with a null IV</p></td>
<td align="left" valign="top"><p class="table">variable</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Padding</p></td>
<td align="left" valign="top"><p class="table">variable</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">CRC-16 of the cleartext data block</p></td>
<td align="left" valign="top"><p class="table">02</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>The target key is disabled after 10 invalid CRC-16 have been received in sequence.</p></div>
<div class="paragraph"><p>After each invalid CRC-16, the dongle has to be power cycled before accepting another command.</p></div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2014-08-24 21:39:20 CEST
</div>
</div>
</body>
</html>
